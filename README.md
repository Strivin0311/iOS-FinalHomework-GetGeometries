# iOS-FinalHomework-GetGeometries

## 一、程序说明：

### 1. 游戏简介：

  * 本程序是一个基于CoreML和ARKit、SceneKit制作的小游戏
  * 通过iOS设备的摄像头捕获现实场景中的一个水平面
  * 捕获之后，水平面上定时会有一个几何体竖直向上抛掷
  * 游戏的任务就是要在几何体回落到水平面之前，通过点击按钮（或者摇晃设备）的方式选出对应的几何体的形状和颜色
  * 形状和颜色完全匹配之后会得到相应的分数（连续匹配成功会有技能奖励）；否则生命值减一
  * 若生命值衰减为零之前匹配完一定数目的几何体，则本局游戏成功，记录分数和表现星级；否则游戏失败

### 2. 界面操作说明：

#### ① 关卡列表界面：
   
  * 如下图所示：
  > ![关卡列表](https://github.com/Strivin0311/iOS-FinalHomework-GetGeometries/tree/main/images/关卡列表.png)

  * 总共有11关，每一关的难度等级由该行对应的星星个数评定，从1星(简单)~5星(困难)

  * 前十关设定固定，第11关的设定随机，相当于”无尽模式“

  * 点击任意一个cell，将进入对应的”关卡详细设定界面“

  * 点击任意一个cell最右边的”Play“按钮，可以进入”游戏界面“，并开始本关游戏

  * 点击右上角的”Records>”按钮，可以进入”游戏记录列表界面“，并查看历史游戏记录

#### ② 关卡详细设定界面：

  * 如下图所示：
  > ![关卡详细设定](https://github.com/Strivin0311/iOS-FinalHomework-GetGeometries/tree/main/images/关卡详细设定.png)

  * 该界面展示了对应关卡的难度星级、几何体形状种类、几何体颜色种类、几何体个数和生命值

  * 同理，点击下方的”Play“按钮，可以进入”游戏界面“并开始本关游戏

#### ③ 游戏记录列表界面：

  * 如下图所示：
  > ![游戏记录列表](https://github.com/Strivin0311/iOS-FinalHomework-GetGeometries/tree/main/images/游戏记录列表.png)

  * 该界面陈列了历史游戏记录

  * 若还未进行任何游戏或者删除了所有游戏记录，会自动加载”样例记录“

  * 每一个cell简单说明了某次游戏的关卡、时间和是否通关的信息

  * 点击任意一个cell可以进入”游戏详细记录界面“，查看对应游戏的详细记录

  * 左滑任意一个cell可以弹出删除按钮，点击可以将对应记录删除

  * 点击左上角的”< Back“按钮可以返回”关卡列表界面“

#### ④ 游戏详细记录界面：

  * 如下图所示：
  > ![游戏详细记录](https://github.com/Strivin0311/iOS-FinalHomework-GetGeometries/tree/main/images/游戏详细记录.png)

  > ![游戏详细记录](https://github.com/Strivin0311/iOS-FinalHomework-GetGeometries/tree/main/images/游戏详细记录2.png)

  * 该界面详细展示了某次游戏的关卡、时间、是否通关以及如果通关，则展示获得的分数和表现星级

  * 如果是从”游戏记录列表界面“进入该界面，则点击左上角的”< Back“按钮可以返回”游戏记录列表界面“

  * 如果是从”游戏界面“进入该界面（每局游戏结束后会自动跳转该页面并展示本次游戏的详细记录），则点击右下角的”Back“按钮可以直接返回”关卡列表界面“

#### ⑤ 游戏界面：

  * 如下图所示：
  > ![游戏](https://github.com/Strivin0311/iOS-FinalHomework-GetGeometries/tree/main/images/游戏.png)

  * 首先在现实世界找到一个较为规则的水平面，如桌面、茶几等

  * 通过设备，对着该水平面进行左右扫描，会逐渐生成一个半透明的虚拟水平面

  * 生成之后，游戏自动开始，每隔3秒会有一个几何体（**形状和颜色随机**）从虚拟水平面竖直向上抛掷，再回落并碰撞水平面，同时产生粒子效果的火花

  * 左上角的”Number“记录了当前还有多少个几何体等待被抛掷，如果在**生命值衰减为零之前**所有几何体都抛掷完成，则游戏**以成功结束**

  * 玩家需要在该几何体回落并与水平面碰撞之前通过点击左下角的”+shape+“按钮和右下角的”+color+“按钮，分别按一定的顺序依次改变正上方的label的形状和颜色

  * 如果该label的形状和颜色与抛出的几何体颜色**完全匹配**，则右上角的”Score“将会增加相应的分数

  * 如果需要同时改变形状和颜色则加2分，如果只需改变其中之一则加1分，否则不加分

  * 如果能够连续匹配成功，最中间会相应闪烁连击次数（如”3 hits!!!“）

  * 如果没有在回落水平面之前成功匹配，则左上角的”Life“值会减1，同时屏幕红色闪烁，**衰减至零后**游戏**以失败退出**

  * 同时，为了加入**CoreML**的特性，本程序增加了一个**额外技能**，即通过（使劲）摇动设备，会触发”完美匹配“技能，瞬间使得label的形状和颜色与抛掷的几何体匹配，同时屏幕黄色闪烁

  * 但是该技能使用次数有限，剩余次数由右上角的”ShakeTimes“所示

  * 不过如果玩家打出3n次连续匹配的好战绩（如3连击、6连击等），会增加n次使用该技能的机会

***

## 二、代码文件说明：

  * 代码行数：经过手动统计，10个源码文件共计2014行代码

  * 源码文件说明：

    * GeometryViewController.swift: ”游戏界面“控制器，封装了游戏逻辑以及游戏控件，包括各种label的改变、几何体的生成、碰撞后的回调以及设备摇晃的检测和回调等

    * TaskTableViewController.swift / TaskDetailsViewController.swift / TaskTableViewCell.swift: 分别是”关卡列表界面“、”关卡详细设定界面”和关卡列表cell的控制器

    * RecordsTableViewController.swift / RecordsTableViewCell.swift / ResultViewController.swift: 分别是“游戏记录界面”、游戏记录cell和“游戏详细记录界面”的控制器

    * Record.swift: 游戏记录的数据类，用于从文件中读写游戏记录

    * Enum.swift: 封装了各种枚举类，如几何体形状枚举（使用该枚举可以获得各种SceneKit封装的几何体的实例，如球体、棱锥、胶囊等）、几何体颜色枚举等
   
    * Node.swift: 封装了平面节点类和几何体节点类，用于向AR世界中添加虚拟水平面和几何体，以及定义了其物理运动规则

  * 其他重要文件说明：

    * Big Explode.scnp: 几何体和水平面碰撞时产生的粒子系统的源文件

    * GestureClassifier.mlmodel: 用于捕获和分析设备摇晃动作的机器学习模型
